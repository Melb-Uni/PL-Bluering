<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>demo</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <script src="../static/js/index.js"></script>
    <script src="../static/js/lib/vue.min.js"></script>
    <script src="../static/js/lib/pixi.min.js"></script>
    <link rel="stylesheet" href="../static/css/index.css">
    <script src="../static/js/lib/axios.min.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
</head>
<body>
<div id = "app">
    <el-container>
        <div v-if="!renderAnim">
            <el-header>Build Visualisation From Problem</el-header>
            <el-main>
                <div>OPTION 1-PLANNER URL </div>
                <el-row>
                    <el-col :span="3"><div >Enter URLï¼š</div></el-col>
                    <el-col :span="18">
                        <el-input v-model="plannerURL" placeholder="please input the url"></el-input>
                    </el-col>
                </el-row>

    <!--            <div id="testValue" v-text="value">-->
    <!--                {{value}}-->
    <!--            </div>-->
                <div>OPTION 2-Upload PROBLEM, DOMAIN and ANIMATION PROFILE files </div>
                <el-row>
                    <el-col :span="8"><div >Domain File</div></el-col>
                    <el-col :span="8">
                        <div >Problem File</div>
                    </el-col>
                    <el-col :span="8">
                        <div >Animation Profile</div>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="8">
                        <el-upload
                                class="upload-demo"
                                drag
                                action=""
                                :on-change="(file, fileList) => {handleChange(file, fileList, 'domain')}"
                                :auto-upload = "false"
                                :file-list="fileList"
                                limit="1">
                            <i class="el-icon-upload"></i>
                            <div class="el-upload__text">drag the file here, or <em>Click to Upload</em></div>
                            <div class="el-upload__tip" slot="tip">DOMAIN.PDDL</div>
                        </el-upload>
                    </el-col>
                    <el-col :span="8">
                        <el-upload
                                class="upload-demo"
                                drag
                                action=""
                                :on-change="(file, fileList) => {handleChange(file, fileList, 'problem')}"
                                :file-list="fileList"
                                :auto-upload = "false">
                            <i class="el-icon-upload"></i>
                            <div class="el-upload__text">drag the file here, or <em>Click to Upload</em></div>
                            <div class="el-upload__tip" slot="tip">PROBLEM.PDDL</div>
                        </el-upload>
                    </el-col>
                    <el-col :span="8">
                        <el-upload
                                class="upload-demo"
                                drag
                                action=""
                                :on-change="(file, fileList) => {handleChange(file, fileList, 'anim')}"
                                :file-list="fileList"
                                :auto-upload = "false">
                            <i class="el-icon-upload"></i>
                            <div class="el-upload__text">drag the file here, or <em>Click to Upload</em></div>
                            <div class="el-upload__tip" slot="tip">ANIMATION.PDDL</div>
                        </el-upload>
                    </el-col>
                </el-row>
                <el-button style="margin-left: 10px;" size="small" type="success" @click="submitUpload">continue</el-button>
            </el-main>
            <el-header>Build Visualisation From solution VFG</el-header>
            <el-main>
                <div>SELECT VFG FILE TO GENERATE VISUALISATION DIRECTLY.</div>
                <el-upload
                        class="upload-demo"
                        drag
                        action=""
                        :on-change="(file, fileList) => {handleChange(file, fileList, 'domain')}"
                        :file-list="fileList"
                        :auto-upload = "false">
                    <i class="el-icon-upload"></i>
                    <div class="el-upload__text">drag the file here, or <em>Click to Upload</em></div>
                    <div class="el-upload__tip" slot="tip">VFG(.vfg) file</div>
                </el-upload>

            </el-main>
        </div>

        <div v-if="renderAnim" >

            <div id="pixi" style="position: relative;display: flex">
            </div>

        </div>

    </el-container>


</div>
<script>
    var vm = new Vue({
        el: '#app',
        data:{
            renderAnim:false,
            plannerURL:"http://solver.planning.domains/solve",
            value:10,
            v_appWi:600,
            v_appHi:400,
            pddlForm:{"domain": "","problem":"","anim":""},
            fileList:[],
            responseEvent:{}
        },
        mounted(){
            //this.init_pixi();
        },
        methods:{
            init_pixi() {

                var that = this;
                // const app = new PIXI.Application({ width: that.v_appWi,
                //     height: that.v_appHi,antialias: true,transparent: false,
                //     resolution: 1});
                //
                // document.getElementById("pixi").appendChild(app.view);
                //
                // const loader = new PIXI.Loader();
                // loader.add("../static/images/dog.jpeg").load(setup);
                //
                // function setup() {
                //
                //     let pic = new PIXI.Sprite(loader.resources["../static/images/dog.jpeg"].texture);
                //
                //     //Add the cat to the stage
                //     app.stage.addChild(pic);
                //
                //     //If you ever need to, here's how you can clean out WebGL's GPU
                //     //memory manually
                //     /*
                //     Object.keys(TextureCache).forEach(function(texture) {
                //       TextureCache[texture].destroy(true);
                //     });
                //     */
                // }

                const app = new PIXI.Application();
                document.body.appendChild(app.view);

                const aliens = [];

                const totalDudes = 5;

                for (let i = 0; i < totalDudes; i++) {
                    // create a new Sprite that uses the image name that we just generated as its source
                    const dude = PIXI.Sprite.from('../static/images/dog.jpeg');

                    // set the anchor point so the texture is centered on the sprite
                    dude.anchor.set(0.5);

                    // set a random scale for the dude - no point them all being the same size!
                    dude.scale.set(0.8 + Math.random() * 0.3);

                    // finally lets set the dude to be at a random position..
                    dude.x = Math.random() * app.screen.width;
                    dude.y = Math.random() * app.screen.height;

                    dude.tint = Math.random() * 0xFFFFFF;

                    // create some extra properties that will control movement :
                    // create a random direction in radians. This is a number between 0 and PI*2 which is the equivalent of 0 - 360 degrees
                    dude.direction = Math.random() * Math.PI * 2;

                    // this number will be used to modify the direction of the dude over time
                    dude.turningSpeed = Math.random() - 0.8;

                    // create a random speed for the dude between 2 - 4
                    dude.speed = 2 + Math.random() * 2;

                    // finally we push the dude into the aliens array so it it can be easily accessed later
                    aliens.push(dude);

                    app.stage.addChild(dude);
                }

                // create a bounding box for the little dudes
                const dudeBoundsPadding = 100;
                const dudeBounds = new PIXI.Rectangle(-dudeBoundsPadding,
                    -dudeBoundsPadding,
                    app.screen.width + dudeBoundsPadding * 2,
                    app.screen.height + dudeBoundsPadding * 2);

                app.ticker.add(() => {
                    // iterate through the dudes and update their position
                    for (let i = 0; i < aliens.length; i++) {
                        const dude = aliens[i];
                        dude.direction += dude.turningSpeed * 0.01;
                        dude.x += Math.sin(dude.direction) * dude.speed;
                        dude.y += Math.cos(dude.direction) * dude.speed;
                        dude.rotation = -dude.direction - Math.PI / 2;

                        // wrap the dudes by testing their bounds...
                        if (dude.x < dudeBounds.x) {
                            dude.x += dudeBounds.width;
                        } else if (dude.x > dudeBounds.x + dudeBounds.width) {
                            dude.x -= dudeBounds.width;
                        }

                        if (dude.y < dudeBounds.y) {
                            dude.y += dudeBounds.height;
                        } else if (dude.y > dudeBounds.y + dudeBounds.height) {
                            dude.y -= dudeBounds.height;
                        }
                    }
                });

                // app.renderer.view.style.border = "1px dashed black";
                // app.renderer.backgroundColor = 0x061639;
            },
            test_render :function(){
                this.renderAnim = !this.renderAnim;
                this.init_pixi()
            },
            submitUpload:function(){
                var that = this;
                let data = new FormData();
                data.append("domain", this.pddlForm["domain"]);
                data.append("problem",this.pddlForm["problem"]);
                data.append("animation",this.pddlForm["anim"]);
                data.append("plan", "");
                data.append("url",this.plannerURL);

                axios({
                    method:'post',
                    url:'https://planimation.planning.domains/upload/pddl',
                    data: data,
                    headers:{
                    'Content-Type': 'multipart/form-data'
                    }
                    }).then(function (response) {
                        console.log(response);
                        that.responseEvent = response["data"]

                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            handleChange(file,fileList,mode) {
                let reader = new FileReader()
                reader.readAsText(file.raw)
                reader.onload =  (e) =>{
                    const fileString = e.target.result;
                    this.pddlForm[mode] = fileString;
                }
            },
            beforeUploadPDDL(file) {
                const isPDDL = file.type === 'pddl';

                if (!isPDDL) {
                    this.$message.error('the file need to be in PDDL type!');
                }
                return isPDDL;
            }

        }
    })
</script>

</body>


</html>